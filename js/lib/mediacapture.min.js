(function(z){var g=navigator.device,w={},o=z.WebKitBlobBuilder||z.MozBlobBuilder||z.BlobBuilder,d=z.WebKitFileReader||z.MozFileReader||z.FileReader,l=z.webkitURL||z.MozURL||z.URL;function h(G,i){return l.createObjectURL(c(G,i))}function c(M,K){if(!o){return{data:K}}var I,G=window.atob(K),H=new Uint8Array(G.length),J,L=new o();for(J=0;J<H.length;J++){H[J]=G.charCodeAt(J)}L.append(H.buffer);I=L.getBlob(M);return I}function t(G,i){return"data:"+G+";base64,"+i}g={load:function(i){var H=document.createElement("div"),K=document.createElement("div"),J=document.createElement("div"),I=document.createElement("div"),G=this;I.className="mc-close-button";I.innerHTML="&Cross;";H.id="mc-flashobject";K.className="mc-wrapper";J.className="mc-menu";K.appendChild(I);K.appendChild(H);K.appendChild(J);document.body.appendChild(K);K.style.left=(window.innerWidth/2-this.width/2).toString()+"px";K.style.top=(window.innerHeight/2-this.height/2).toString()+"px";this.flashElement=H;this.callback=i;swfobject.embedSWF(this.swf,this.flashElement.id,"320","240","10.1.0",null,null,{quality:"high",bgcolor:"#ffffff",allowscriptaccess:"sameDomain"},null,function(L){G.flashElement=L.ref;G.flashWrapper=L.ref.parentNode;G.flashWrapper.style.display="inline-block";if(G.callback){setTimeout(function(){G.callback()},200)}});return H},initialized:false,FLASH_SIZE_WITHOUT_PERMISSION:60,width:400,height:310,callback:null,flashWrapper:null,flashElement:null,swf:"MediaCapture.swf"};w={css:{stylesheet:(function(){var i=document.createElement("link");i.setAttribute("rel","stylesheet");i.setAttribute("href","mediacapture.css");i.setAttribute("id","mc-style");document.head.appendChild(i);return i}()),show:"inline-block",hide:"none"},captureBtn:{element:null,display:true},stopBtn:{element:null,display:true},menu:null,toggleCaptureBtn:function(){this.captureBtn.element.style.display=this.captureBtn.display?this.css.hide:this.css.show;this.captureBtn.display=!this.captureBtn.display},toggleStopBtn:function(){this.stopBtn.element.style.display=this.stopBtn.display?this.css.hide:this.css.show;this.stopBtn.display=!this.stopBtn.display},show:function(G,i){g.flashWrapper.style.visibility="visible";var J=g.flashWrapper.querySelector(".mc-menu"),I,H;J.innerHTML="<button class='mc-button mc-capture'>Capture</button><button class='mc-button mc-stop'>Stop</button>";I=J.querySelector(".mc-capture");H=J.querySelector(".mc-stop");I.style.display=w.css.show;H.style.display=w.css.show;I.addEventListener("click",function(K){G()},false);H.addEventListener("click",function(K){i()},false);w.menu=J;w.captureBtn.element=I;w.stopBtn.element=H;g.flashWrapper.style.display=this.css.show},hide:function(){this.menu.innerHTML="";g.flashWrapper.style.visibility="hidden";document.body.removeChild(g.flashWrapper)}};function e(i){this.cancel=i}function q(i){this.code=i}q.CAPTURE_APPLICATION_BUSY=0;q.CAPTURE_INTERNAL_ERR=1;q.CAPTURE_INVALID_ARGUMENT=2;q.CAPTURE_NO_MEDIA_FILES=3;function r(i,G){return G(i)}function D(i,G){return G(new q(i))}function f(i){return{limit:i.limit||1,duration:i.duration||0}}function m(i){return{limit:i.limit||1,width:i.width,height:i.height,format:i.format}}function v(i){return{limit:i.limit||1,duration:i.duration||0}}function n(G,I,i,H,J){this.codecs=G;this.bitrate=I;this.height=i;this.width=H;this.duration=J}function k(G,i,H){return new n(G,0,i,H,0)}function p(G,i,H,I){return new n(G,0,i,H,I)}function u(i,G,H){return new n(i,G,0,0,H)}function b(I,G,i){var H=new e(null);i=i||{};g.load(function(){z.__mediacapture_audioerror=function(L){D(L,G)};z.__mediacapture_audiocomplete=function(M){var L=c("audio/wav",M);if(L.size==g.FLASH_SIZE_WITHOUT_PERMISSION){return D(q.CAPTURE_NO_MEDIA_FILES,G)}r(L,I)};i=f(i||{});g.flashElement.initMicrophone(i.limit,i.duration);function J(){g.flashElement.captureAudio();w.toggleCaptureBtn()}function K(){g.flashElement.cancelAudio();w.toggleCaptureBtn();w.toggleStopBtn();i.limit--;if(i.limit==0){w.hide()}}w.show(J,K);H.cancel=g.flashElement.cancelAudio;return H});return H}function x(I,G,i){var H={};i=i||{};g.load(function(){var L=i.codec||"jpeg";z.__mediacapture_cameraerror=function(M){D(M,G)};z.__mediacapture_cameracomplete=function(N){var M=c("image/"+L,N);r(M,I)};i=m(i||{});g.flashElement.initCamera(i.limit,i.duration);function K(){g.flashElement.captureImage(L);i.limit--;if(i.limit==0){w.hide()}}function J(){g.flashElement.cancelVideo()}w.show(K,J);H.cancel=g.flashElement.cancelVideo;return H});return H}function C(H,G,i){}var F=["png","jpeg","jpg"],a=[k(F[0],640,480),k(F[1],640,480),k(F[2],640,480)],B=[u("wav",0,0)];navigator.device={supportedImageFormats:a,supportedAudioFormats:B,captureImage:x,captureAudio:b,captureVideo:undefined};function j(G,I){for(var H=0;H<G.length;H++){if(G.indexOf(G[H].codecs)){return true}}return false}function y(I,H,J,G){function K(M){var L=document.createElement("img");if(o&&l){L.src=l.createObjectURL(M);L.addEventListener("load",function(N){l.revokeObjectURL(this.src)},false)}else{L.src=t("image/"+J,M.data)}G.parentNode.appendChild(L)}function i(L){var M=document.createElement("audio");if(o&&l){M.src=l.createObjectURL(L);l.revokeObjectURL(this.src)}else{M.src=t("audio/"+J,L.data)}M.autoplay="autoplay";M.controls="controls";G.parentNode.appendChild(M)}if(I==="camera"&&H==="image"&&j(a,J)){x(K,function(L){},{codec:J})}else{if(I==="microphone"&&H==="audio"&&j(a,J)){b(i,function(L){})}else{if(I==="camcorder"){return false}else{return false}}}return true}function E(i){var G=i.target,I=G.getAttribute("accept").split("/"),H=G.getAttribute("capture");if(y(H,I[0],I[1],G)){i.preventDefault();return false}}var s=document.querySelectorAll("input[type='file'][accept][capture]"),A;for(A=0;A<s.length;A++){s[A].addEventListener("click",E,false)}}(window));